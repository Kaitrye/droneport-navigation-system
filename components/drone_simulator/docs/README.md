# Drone Simulator Component

Компонент-симулятор дрона для тестирования дронопорта (НУС).

## Описание

`DroneSimulator` имитирует поведение дрона и позволяет тестировать процессы дронопорта:
- Приём рейса
- Посадка
- Безопасная зона
- Выгрузка/загрузка
- Зарядка
- Осмотр
- Хранение

## Возможности

### Состояния дрона

- `idle` - Ожидание
- `taking_off` - Взлет
- `flying` - В полете
- `landing` - Посадка
- `landed` - Приземлен
- `charging` - Зарядка
- `maintenance` - Обслуживание
- `error` - Ошибка

### Операции

- **Взлет** (`takeoff`) - Симуляция взлета дрона на заданную высоту
- **Посадка** (`land`) - Симуляция посадки дрона в указанную позицию
- **Движение** (`move`) - Симуляция перемещения дрона к целевой позиции
- **Зарядка** (`charge`) - Симуляция зарядки батареи дрона
- **Получение состояния** (`get_state`) - Возвращает текущее состояние дрона

**Реальное использование:**

```python
from src.drone_simulator import DroneSimulator

# Дронопорт создаёт дрона
drone = DroneSimulator(
    drone_id="drone_001",
    name="Drone 001",
    initial_battery=100.0
)

# Управление дроном
drone.takeoff(altitude=15.0)
drone.move(target_position={"x": 50.0, "y": 60.0, "z": 12.0}, speed=8.0)
drone.land(position={"x": 50.0, "y": 60.0}, droneport_id="droneport_001")
drone.charge(target_level=100.0)

# Проверка состояния
state = drone.get_state()  # status, battery, position, is_at_droneport...
```

См. `example_usage.py` для полного примера.

### API (методы класса)

| Метод | Описание |
|-------|----------|
| `takeoff(altitude)` | Взлёт на высоту (м). Требует ≥20% батареи. |
| `land(position, droneport_id)` | Посадка в позицию, привязка к дронопорту. |
| `move(target_position, speed)` | Перемещение к точке (только в полёте). |
| `charge(target_level)` | Зарядка до уровня (только в дронопорте). |
| `get_state()` | Текущее состояние: status, battery, position, is_at_droneport... |

## Интеграция с дронопортом

Компонент предназначен для тестирования систем дронопорта:

1. **Приём рейса**: Дрон получает команду на посадку (`land`) с указанием позиции и ID дронопорта
2. **Безопасная зона**: Дрон проверяет статус перед операциями
3. **Зарядка**: Дрон может заряжаться только когда находится в дронопорте (`is_at_droneport = true`)
4. **Очередь рейсов**: Система дронопорта может запрашивать состояние дрона (`get_state`) для планирования
5. **Режимы ЧС**: Дрон может перейти в статус `error` при критических ситуациях (например, разряд батареи)

## Параметры состояния

- `status` - Текущий статус дрона
- `battery` - Уровень батареи (0-100%)
- `position` - Позиция дрона `{"x": float, "y": float, "z": float}`
- `altitude` - Высота полета (метры)
- `speed` - Скорость движения (м/с)
- `is_at_droneport` - Находится ли дрон в дронопорте
- `droneport_id` - ID дронопорта, где находится дрон
- `total_flights` - Общее количество полетов
- `flight_time` - Время в полете (секунды)

## Ограничения

- Взлет возможен только из статусов `idle` или `landed`
- Взлет требует минимум 20% батареи
- Посадка возможна только из статусов `flying` или `taking_off`
- Движение возможно только в статусе `flying`
- Зарядка возможна только когда дрон находится в дронопорте (`is_at_droneport = true`)
- Батарея автоматически уменьшается во время полета

## Тестирование

Запуск тестов:

```bash
pytest tests/
```
